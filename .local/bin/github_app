#!/bin/sh

set -eu

# Define the JSON payload using printf for readability
json_payload=$(printf '{
  "name": "Octoapp",
  "url": "https://www.example.com",
  "hook_attributes": {
    "url": "https://example.com/github/events"
  },
  "redirect_url": "https://example.com/redirect",
  "callback_urls": [
    "https://example.com/callback"
  ],
  "public": true,
  "default_permissions": {
    "issues": "write",
    "checks": "write"
  },
  "default_events": [
    "issues",
    "issue_comment",
    "check_suite",
    "check_run"
  ]
}')

# Send the request using curl
curl --silent --fail --request POST \
  --url "https://github.com/organizations/craigsloggett-lab/settings/apps/new?state=abc123" \
  --header "Content-Type: application/json" \
  --header "Authorization: Bearer ${GITHUB_TOKEN}" \
  --data "${json_payload}"
